<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Space Quiz â€” Lifelines Edition</title>
<style>
:root{--bg:#0a0e22;--hud:#0f1533;--frame:#49e6ff;--cyan:#37D6E8;--panel:#0b1126;--pill:#0E152B;--text:#fff;--muted:#a7b3cc;--accent:#37D6E8;--ok:#22c55e;--bad:#ef4444}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:flex;align-items:center;justify-content:center;padding:18px}
.hud{width:1200px;max-width:100%}
.screen{height:720px;background:radial-gradient(1600px 900px at 10% -10%,#0f214d 0%,#0a0e22 55%),radial-gradient(900px 700px at 120% 120%,#0d1a44 0%,#0a0e22 60%),var(--hud);border:2px solid var(--frame);border-radius:28px;box-shadow:0 20px 60px rgba(0,0,0,.55);padding:16px;display:grid;grid-template-rows:auto auto 1fr;gap:10px;position:relative;overflow:hidden}
.screen:before{content:"";position:absolute;inset:10px;border-radius:22px;border:2px solid rgba(73,230,255,.35);outline:1px solid rgba(73,230,255,.15);box-shadow:inset 0 0 30px rgba(73,230,255,.08),inset 0 0 2px rgba(73,230,255,.75);pointer-events:none}
header{display:flex;align-items:center;justify-content:space-between}
.badge{font-size:12px;border:1px solid rgba(73,230,255,.35);padding:6px 10px;border-radius:999px;color:#a7b3cc;display:inline-flex;align-items:center;gap:6px}
.btn{cursor:pointer;user-select:none}
.btn[disabled]{opacity:.45;cursor:not-allowed}

/* Question pill â€” richer gradient */
.qpill{display:flex;align-items:center;gap:12px;background:linear-gradient(135deg, var(--cyan) 0%, #2fd0e2 35%, #1ab7cc 70%, #0ea5b7 100%);color:#042a31;border:2px solid #79f0ff;border-radius:24px;padding:10px 18px 6px;position:relative;overflow:hidden}
.qpill::after{content:"";position:absolute;inset:0;background:linear-gradient(to bottom, rgba(255,255,255,.18), transparent 48%);pointer-events:none}

/* Avatar ~+40% and truly flush with bottom */
.qthumb{width:168px;height:168px;border-radius:18px;align-self:stretch;display:flex;align-items:flex-end;overflow:hidden;flex:0 0 auto;margin-bottom:-2px}
.qthumb img{width:100%;height:100%;object-fit:contain;object-position:center bottom;transition:opacity .28s ease}
.qthumb img.fade-out{opacity:0}

/* Question text + pill art (bigger, closer) */
#qtext{font-weight:900;font-size:28px;letter-spacing:.3px;text-shadow:0 1px 0 rgba(255,255,255,.25);line-height:1.15}
.qart{width:118px;height:118px;flex:0 0 auto;display:grid;place-items:center;margin-left:8px}
.qart svg{width:118px;height:118px;display:block}

/* Layout */
.row{display:grid;grid-template-columns:650px minmax(0,1fr);gap:24px;min-height:0}
.card{background:var(--panel);border-radius:22px;border:4px solid var(--accent);padding:18px;display:grid;grid-template-rows:1fr auto;gap:12px}
#answers{list-style:none;padding:8px;margin:0;display:grid;gap:14px;overflow:visible}
.answer{display:flex;align-items:center;gap:12px;background:var(--pill);border:2px solid rgba(55,214,232,.8);border-radius:20px;padding:18px 20px;cursor:pointer;transition:transform .07s ease,border-color .2s ease,box-shadow .2s ease}
.answer:hover{transform:translateY(-1px);box-shadow:0 0 0 4px rgba(55,214,232,.12)}
.answer.hidden{display:none}
.dot{position:relative;width:30px;height:30px;border-radius:50%;border:3px solid var(--accent);box-shadow:inset 0 0 0 4px rgba(0,0,0,.35)}
.answer .label{font-weight:800}
.answer.selected .dot::after,.answer.correct .dot::after{content:"";position:absolute;inset:6px;border-radius:50%;background:var(--accent)}
.answer.correct{border-color:var(--ok)}.answer.incorrect{border-color:var(--bad)}
footer{display:flex;align-items:center;justify-content:flex-end;gap:10px}
#status{min-height:22px;color:var(--muted);margin-right:auto}
button{background:linear-gradient(180deg,#1fc7e8,#0ea5b7);color:#05222a;border:none;padding:12px 16px;border-radius:12px;font-weight:900;letter-spacing:.3px;cursor:pointer;box-shadow:0 6px 16px rgba(31,199,232,.35)}
button.secondary{background:transparent;color:var(--text);border:1px solid rgba(73,230,255,.35);box-shadow:none}
button:disabled{opacity:.6;cursor:not-allowed}

/* Right hero area + fade-in */
.hero{background:transparent;display:flex;align-items:center;justify-content:center;padding:0;position:relative;overflow:hidden}
.fadewrap{opacity:0;transition:opacity .5s ease}
.fadewrap.show{opacity:1}

/* Default question art size */
.hero svg{width:100%;max-width:880px;height:auto;display:block}
/* Answer mode: imagery larger (~180%) */
.hero.answer-mode svg{width:180%;max-width:none}

/* End video overlay */
#videoOverlay{position:fixed;inset:0;background:#000;display:none;align-items:center;justify-content:center;z-index:9999}
#videoOverlay video{width:100%;height:100%;object-fit:cover}

/* Music slider */
#musicVol{width:90px;vertical-align:middle}

/* Mobile */
@media (max-width:1024px){.row{grid-template-columns:1fr}.hero{order:-1}}
</style>
</head>
<body>

<!-- Music -->
<audio id="bgMusic" src="Uncharted Worlds.mp3" loop></audio>

<!-- End video -->
<div id="videoOverlay">
  <video id="winVideo" src="goodjob.mp4" playsinline></video>
</div>

<div class="hud">
  <div class="screen">
    <header>
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <div class="badge">Question <span id="qnum">1</span>/<span id="qtotal">10</span></div>

        <!-- Lifelines -->
        <div class="badge" style="gap:8px">
          Lifelines:
          <button id="ll5050" class="btn badge" title="Remove two wrong answers (once)">50/50</button>
          <button id="llHint" class="btn badge" title="Show a clue (once)">Hint</button>
          <button id="llSkip" class="btn badge" title="Skip this question (once)">Skip</button>
        </div>

        <!-- Audio toggles -->
        <label class="badge"><input type="checkbox" id="sfxToggle" checked/> ðŸ”Š SFX</label>
        <label class="badge"><input type="checkbox" id="musicToggle" checked/> ðŸŽµ Music</label>
        <label class="badge">Vol <input type="range" id="musicVol" min="0" max="1" step="0.01" value="0.15"/></label>
      </div>

      <div id="error" class="badge" style="display:none;color:#ffb4b4"></div>
    </header>

    <!-- Pill: avatar + text + tiny related art -->
    <div class="qpill">
      <div class="qthumb"><img id="thumb" alt="Avatar"/></div>
      <div id="qtext">Loading questionâ€¦</div>
      <div id="qart" class="qart"></div>
    </div>

    <div class="row">
      <div class="card">
        <ul id="answers"></ul>
        <footer>
          <div id="status">Select an answer to continue.</div>
          <button class="secondary" id="resetBtn">Restart</button>
          <button id="nextBtn" disabled>Next</button>
        </footer>
      </div>
      <div class="hero"><div id="hero"></div></div>
    </div>
  </div>
</div>

<script>
/* ---- Avatar assets ---- */
const AVATAR_FILES={neutral:"neutral-expression.png",happy:"happy-expression.png",encourage:"encouraging-expression.png"};
const PLACEHOLDER='data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240"><circle cx="120" cy="120" r="110" fill="#19304f"/><circle cx="120" cy="120" r="100" fill="#264c7a"/></svg>');
function loadAvatar(path,cb){const i=new Image();i.onload=()=>cb(path);i.onerror=()=>cb(PLACEHOLDER);i.src=path}

/* ---- WebAudio SFX ---- */
let audioCtx=null;function ensureAC(){if(!audioCtx){const AC=window.AudioContext||window.webkitAudioContext;audioCtx=new AC();}}
function playCorrect(){if(!document.getElementById('sfxToggle').checked)return;ensureAC();const t=audioCtx.currentTime,o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='sine';o.frequency.setValueAtTime(660,t);o.frequency.exponentialRampToValueAtTime(990,t+.18);g.gain.setValueAtTime(.0001,t);g.gain.exponentialRampToValueAtTime(.28,t+.02);g.gain.exponentialRampToValueAtTime(.0001,t+.24);o.connect(g).connect(audioCtx.destination);o.start(t);o.stop(t+.26)}
function playEnc(){if(!document.getElementById('sfxToggle').checked)return;ensureAC();const t=audioCtx.currentTime,o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='sine';o.frequency.setValueAtTime(300,t);o.frequency.exponentialRampToValueAtTime(240,t+.22);g.gain.setValueAtTime(.0001,t);g.gain.exponentialRampToValueAtTime(.18,t+.02);g.gain.exponentialRampToValueAtTime(.0001,t+.26);o.connect(g).connect(audioCtx.destination);o.start(t);o.stop(t+.28)}
function playVictory(){if(!document.getElementById('sfxToggle').checked)return;ensureAC();const t=audioCtx.currentTime;const freqs=[523.25,659.25,783.99,1046.5]; // C5 E5 G5 C6
freqs.forEach((f,k)=>{const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type='triangle';o.frequency.value=f;g.gain.setValueAtTime(0.0001,t+.05*k);g.gain.exponentialRampToValueAtTime(0.25,t+.05*k+.06);g.gain.exponentialRampToValueAtTime(0.0001,t+.05*k+.5);o.connect(g).connect(audioCtx.destination);o.start(t+.05*k);o.stop(t+.05*k+.6);});}

/* ---- Quiz data (10 Qs) + hints + more ---- */
const QUIZ=[
  {q:"Which is the smallest planet in our Solar System?",choices:["Mercury","Mars","Venus","Pluto"],correct:0,explain:"Mercury is the smallest of the eight major planets.",more:"Its diameter is ~4,880 kmâ€”about 38% of Earthâ€™s size.",hint:"Itâ€™s closest to the Sun.",art:"mercury"},
  {q:"Which planet is known as the Red Planet?",choices:["Jupiter","Mars","Saturn","Neptune"],correct:1,explain:"Mars appears reddish due to iron oxide on its surface.",more:"Seasonal dust storms can envelop the entire planet.",hint:"Named after the Roman god of war.",art:"mars"},
  {q:"What is the name of the galaxy we live in?",choices:["Andromeda","Sombrero","Milky Way","Triangulum"],correct:2,explain:"We live in the Milky Way galaxy.",more:"Itâ€™s a barred spiral about 100,000 light-years across.",hint:"Named after a dairy product.",art:"galaxy"},
  {q:"What force keeps planets in orbit around the Sun?",choices:["Magnetism","Friction","Gravity","Electricity"],correct:2,explain:"Gravity is the attractive force between masses.",more:"The Sunâ€™s gravity curves spacetime, guiding planetary paths.",hint:"Itâ€™s what keeps you on the ground.",art:"galaxy"},
  {q:"Who was the first human to walk on the Moon?",choices:["Buzz Aldrin","Neil Armstrong","Yuri Gagarin","Alan Shepard"],correct:1,explain:"Neil Armstrong stepped onto the lunar surface on July 20, 1969.",more:"Apollo 11â€™s lunar module was called Eagle.",hint:"He said something about a small step.",art:"moon"},
  {q:"Which planet has the most striking ring system?",choices:["Saturn","Uranus","Jupiter","Neptune"],correct:0,explain:"Saturnâ€™s rings are the most prominent.",more:"Theyâ€™re mostly water ice, ranging from dust to boulders.",hint:"This gas giantâ€™s day is only ~10.7 hours.",art:"saturn"},
  {q:"Which planet orbits the Sun in about 88 Earth days?",choices:["Mercury","Earth","Venus","Mars"],correct:0,explain:"Mercuryâ€™s short orbital period is ~88 Earth days.",more:"With almost no atmosphere, surface temps swing wildly.",hint:"Same answer as the smallest planet.",art:"mercury"},
  {q:"What kind of star is the Sun?",choices:["Neutron star","Red giant","Yellow dwarf (G-type)","White dwarf"],correct:2,explain:"The Sun is a G-type main-sequence star.",more:"Itâ€™s about 4.6 billion years old and mid-life.",hint:"Itâ€™s on the main sequence.",art:"sun"},
  {q:"What is the supermassive black hole at the center of the Milky Way called?",choices:["Cygnus X-1","Sagittarius A*","V404 Cygni","Betelgeuse"],correct:1,explain:"Sagittarius A* sits at our galaxyâ€™s core.",more:"It has a mass of roughly four million Suns.",hint:"Itâ€™s in a zodiac constellation.",art:"blackhole"},
  {q:"What is the Kuiper Belt?",choices:["Asteroid belt between Mars and Jupiter","A region beyond Neptune filled with icy bodies and dwarf planets","A field of comets that surrounds the Sun at great distances (the Oort Cloud)","Another name for Saturnâ€™s rings"],correct:1,explain:"The Kuiper Belt lies beyond Neptune and hosts many icy objects, including Pluto.",more:"Many short-period comets originate here.",hint:"Itâ€™s beyond Neptune.",art:"kuiper"}
];

/* ---- DOM ---- */
const qtext=document.getElementById('qtext'),answersEl=document.getElementById('answers'),nextBtn=document.getElementById('nextBtn'),resetBtn=document.getElementById('resetBtn'),statusEl=document.getElementById('status'),hero=document.getElementById('hero'),thumb=document.getElementById('thumb'),qart=document.getElementById('qart');
const ll5050=document.getElementById('ll5050'), llHint=document.getElementById('llHint'), llSkip=document.getElementById('llSkip');
document.getElementById('qtotal').textContent=QUIZ.length;

/* ---- Helpers ---- */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function setThumb(state){thumb.classList.add('fade-out');const file=AVATAR_FILES[state];loadAvatar(file,src=>{thumb.src=src;thumb.classList.remove('fade-out')})}

/* ---- Procedural art (pill + answer variants) ---- */
function svgPlanetSmall(fill="#d54c4c",ring=null){const r=ring?`<ellipse cx="42" cy="42" rx="40" ry="13" fill="none" stroke="${ring}" stroke-width="4" opacity=".65"/>`:"";return `<svg viewBox="0 0 84 84"><defs><radialGradient id="g1" cx="55%" cy="45%"><stop offset="0%" stop-color="#fff" stop-opacity=".8"/><stop offset="100%" stop-color="${fill}"/></radialGradient></defs><circle cx="42" cy="42" r="30" fill="url(#g1)"/>${r}</svg>`}
function svgPlanetAnswer(fill="#d54c4c",ringColor=null){const ring=ringColor?`<ellipse cx="520" cy="300" rx="300" ry="94" fill="none" stroke="${ringColor}" stroke-width="22" opacity=".55"/>`:"";return `<svg viewBox="0 0 1040 600"><defs><radialGradient id="ga" cx="48%" cy="44%"><stop offset="0%" stop-color="#fff8"/><stop offset="100%" stop-color="${fill}"/></radialGradient><radialGradient id="gl" cx="50%" cy="50%"><stop offset="0%" stop-color="#7bd3ff40"/><stop offset="100%" stop-color="#0000"/></radialGradient></defs><rect width="1040" height="600" fill="url(#gl)"/><circle cx="520" cy="300" r="240" fill="url(#ga)"/>${ring}</svg>`}
const svgGalaxy=()=>`<svg viewBox="0 0 1040 600"><g transform="translate(650,300)"><ellipse rx="360" ry="90" fill="none" stroke="#7bd3ff" stroke-width="4" opacity=".6"/><ellipse rx="250" ry="70" fill="none" stroke="#a78bfa" stroke-width="4" opacity=".6"/><circle r="48" fill="#ffd27a"/></g></svg>`;
const svgMoonA=()=>`<svg viewBox="0 0 1040 600"><defs><radialGradient id="ml" cx="50%" cy="40%"><stop offset="0%" stop-color="#fff"/><stop offset="100%" stop-color="#dbe6f5"/></radialGradient></defs><circle cx="740" cy="300" r="200" fill="url(#ml)"/></svg>`;
const svgSunA=()=>`<svg viewBox="0 0 1040 600"><defs><radialGradient id="sl" cx="50%" cy="50%"><stop offset="0%" stop-color="#fff59e"/><stop offset="100%" stop-color="#f59e0b"/></radialGradient></defs><circle cx="640" cy="320" r="260" fill="url(#sl)"/></svg>`;
const svgBHole=()=>`<svg viewBox="0 0 1040 600"><g transform="translate(650,320)"><circle r="110" fill="#000"/><ellipse rx="360" ry="132" fill="none" stroke="#8b5cf6" stroke-width="10" opacity=".6"/><ellipse rx="460" ry="160" fill="none" stroke="#c4b5fd" stroke-width="7" opacity=".45"/></g></svg>`;
const svgKuipr=()=>`<svg viewBox="0 0 1040 600"><g fill="#bfe7ff" opacity=".9"><circle cx="380" cy="300" r="12"/><circle cx="460" cy="220" r="10"/><circle cx="540" cy="340" r="11"/><circle cx="620" cy="250" r="9"/><circle cx="700" cy="330" r="12"/><circle cx="780" cy="240" r="10"/></g></svg>`;

function renderQArt(art){let svg="";switch(art){case "mars":svg=svgPlanetSmall("#d14b4b");break;case "saturn":svg=svgPlanetSmall("#d6b36a","#c6b28a");break;case "mercury":svg=svgPlanetSmall("#a6abb6");break;case "sun":svg=svgPlanetSmall("#f59e0b");break;case "galaxy":svg='<svg viewBox="0 0 84 84"><g transform="translate(42,42)"><ellipse rx="32" ry="9" fill="none" stroke="#7bd3ff" stroke-width="3" opacity=".6"/><ellipse rx="22" ry="7" fill="none" stroke="#a78bfa" stroke-width="3" opacity=".6"/><circle r="8" fill="#ffd27a"/></g></svg>';break;case "moon":svg='<svg viewBox="0 0 84 84"><circle cx="42" cy="40" r="26" fill="#e5edf7"/></svg>';break;case "blackhole":svg='<svg viewBox="0 0 84 84"><g transform="translate(42,42)"><circle r="16" fill="#000"/><ellipse rx="34" ry="12" fill="none" stroke="#7c3aed" stroke-width="3" opacity=".7"/></g></svg>';break;case "kuiper":svg='<svg viewBox="0 0 84 84"><g fill="#bfe7ff"><circle cx="20" cy="42" r="3"/><circle cx="34" cy="24" r="3"/><circle cx="48" cy="46" r="3"/><circle cx="62" cy="32" r="3"/></g></svg>';break;default:svg=svgPlanetSmall("#a6abb6");}qart.innerHTML=svg}

/* right panel: answer imagery (distinct), with centered text ABOVE image */
function renderHeroAnswer(art,title,info){
  const wrap=document.createElement('div');wrap.className='fadewrap';
  let svg="";switch(art){case "mars":svg=svgPlanetAnswer("#c94b4b","#e3c59a");break;case "saturn":svg=svgPlanetAnswer("#d6b36a","#c6b28a");break;case "mercury":svg=svgPlanetAnswer("#b7bdc8");break;case "sun":svg=svgSunA();break;case "galaxy":svg=svgGalaxy();break;case "moon":svg=svgMoonA();break;case "blackhole":svg=svgBHole();break;case "kuiper":svg=svgKuipr();break;default:svg=svgGalaxy();}
  wrap.innerHTML=`<div style="position:absolute;top:14px;left:14px;right:14px;display:flex;align-items:center;justify-content:center;text-align:center;padding:12px 14px;background:rgba(11,17,38,.70);border:1px solid rgba(73,230,255,.35);border-radius:12px;"><div><div style="font-weight:900;color:#fff;font-size:20px;letter-spacing:.2px">${title}</div><div style="margin-top:6px;font-weight:600;color:#cfe8ff">${info}</div></div></div>${svg}`;
  hero.classList.add('answer-mode');hero.innerHTML="";hero.appendChild(wrap);requestAnimationFrame(()=>wrap.classList.add('show'));
}

/* ---- State ---- */
let order=shuffle([...Array(QUIZ.length).keys()]), idx=0, score=0, answered=new Array(QUIZ.length).fill(null);
let lifelines={fifty:true,hint:true,skip:true}; // each usable once

/* ---- Render ---- */
function updateHeader(){document.getElementById('qnum').textContent=Math.min(idx+1,QUIZ.length)}
function setLifelineButtons(){
  ll5050.disabled=!lifelines.fifty;
  llHint.disabled=!lifelines.hint;
  llSkip.disabled=!lifelines.skip;
}
function renderQuestion(){
  const q=QUIZ[order[idx]];
  qtext.textContent=q.q;
  renderQArt(q.art);                // pill art
  hero.classList.remove('answer-mode');
  hero.innerHTML = '<div class="fadewrap show"></div>'; // clear right side
  answersEl.innerHTML='';
  q.choices.forEach((t,i)=>{
    const li=document.createElement('li');
    li.className='answer';
    li.dataset.index=i;
    li.innerHTML=`<span class="dot"></span><span class="label">${t}</span>`;
    li.addEventListener('click',()=>selectAnswer(i,li,q));
    answersEl.appendChild(li);
  });
  statusEl.textContent='Select an answer to continue.';
  nextBtn.disabled=true;
  setThumb('neutral');
  updateHeader();
  setLifelineButtons();
}

/* ---- Lifelines ---- */
function use5050(){
  if(!lifelines.fifty) return;
  const q=QUIZ[order[idx]];
  const wrong=[0,1,2,3].filter(i=>i!==q.correct);
  shuffle(wrong);
  const remove=wrong.slice(0,2);
  document.querySelectorAll('#answers .answer').forEach(li=>{
    const i=parseInt(li.dataset.index,10);
    if(remove.includes(i)) li.classList.add('hidden');
  });
  lifelines.fifty=false; setLifelineButtons();
}
function useHint(){
  if(!lifelines.hint) return;
  const q=QUIZ[order[idx]];
  statusEl.textContent='Hint: '+(q.hint||'Consider the basics of the topic.');
  lifelines.hint=false; setLifelineButtons();
}
function useSkip(){
  if(!lifelines.skip) return;
  statusEl.textContent='Skipped.';
  lifelines.skip=false; setLifelineButtons();
  next(); // advance without affecting score
}

/* ---- Answer handling ---- */
function selectAnswer(i,li,q){
  const qi=order[idx], prev=answered[qi]; answered[qi]=i;
  document.querySelectorAll('.answer').forEach(el=>el.classList.remove('selected','correct','incorrect'));
  li.classList.add('selected');
  const arr=[...document.querySelectorAll('.answer')];
  arr[q.correct]?.classList.add('correct');
  if(i!==q.correct) li.classList.add('incorrect');

  if(prev===null){ if(i===q.correct) score+=1; }
  else{ if(prev===q.correct&&i!==q.correct) score-=1; if(prev!==q.correct&&i===q.correct) score+=1; }

  if(i===q.correct){
    setThumb('happy'); playCorrect();
    statusEl.textContent="Correct!";
    const title = `Answer: ${q.choices[q.correct]}`;
    const info  = `Correct! ${q.explain} ${q.more||""}`.trim();
    renderHeroAnswer(q.art, title, info);
  } else {
    setThumb('encourage'); playEnc();
    statusEl.textContent=`Not quite. ${q.explain}`;
  }
  nextBtn.disabled=false;
}

function next(){ if(idx<QUIZ.length-1){ idx+=1; renderQuestion(); } else { renderVideoEnding(); } }
function reset(){
  score=0; answered=new Array(QUIZ.length).fill(null);
  order=shuffle([...Array(QUIZ.length).keys()]); idx=0; nextBtn.disabled=true;
  lifelines={fifty:true,hint:true,skip:true};
  renderQuestion();
}

/* ---- End video -> victory SFX -> restart quiz & music ---- */
function renderVideoEnding(){
  // Victory sound first
  playVictory();

  document.querySelector('.hud').style.display='none';
  const overlay=document.getElementById('videoOverlay'); const v=document.getElementById('winVideo');
  overlay.style.display='flex'; v.currentTime=0;
  v.play().catch(()=>{ document.addEventListener('click',()=>v.play().catch(()=>{}),{once:true}); });
  v.onended=()=>{
    overlay.style.display='none'; document.querySelector('.hud').style.display='';
    reset(); // restart quiz
    localStorage.setItem('quiz_music_enabled','true'); // ensure ON again
    document.getElementById('musicToggle').checked=true;
    enableMusic();
  };
}

/* ---- Music (autoplay + toggle + volume) ---- */
const bgMusic=document.getElementById('bgMusic');
const musicToggle=document.getElementById('musicToggle');
const musicVol=document.getElementById('musicVol');
bgMusic.volume=parseFloat(musicVol.value||"0.15");

function enableMusic(){ bgMusic.play().catch(()=>{ document.addEventListener('click',()=>bgMusic.play().catch(()=>{}),{once:true}); }); }
function disableMusic(){ bgMusic.pause(); }

if(musicToggle.checked) enableMusic(); // autoplay on load if allowed
musicToggle.addEventListener('change',e=>{ e.target.checked?enableMusic():disableMusic(); });
musicVol.addEventListener('input',e=>{ const v=parseFloat(e.target.value); bgMusic.volume=isNaN(v)?0.15:v; });

/* ---- Wire up ---- */
document.getElementById('nextBtn').addEventListener('click',next);
document.getElementById('resetBtn').addEventListener('click',reset);
ll5050.addEventListener('click',use5050);
llHint.addEventListener('click',useHint);
llSkip.addEventListener('click',useSkip);

/* ---- Init ---- */
(function(){
  try{
    loadAvatar(AVATAR_FILES.neutral,src=>{ thumb.src=src; });
    document.getElementById('qtotal').textContent=QUIZ.length;
    renderQuestion();
  }catch(e){
    const box=document.getElementById('error'); box.style.display='block'; box.textContent='Init error: '+e.message; console.error(e);
  }
})();
</script>
</body>
</html>
