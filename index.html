<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#37d6e8"/>
<title>Foundry Space Quiz</title>
<link rel="manifest" href="./manifest.webmanifest">
<style>
/* ========== THEME ========== */
:root{
  --bg:#0a0e22;
  --hud:#0f1533;
  --frame:#49e6ff;
  --panel:#0b1126;
  --pillTop:#2ee3f1;
  --pillBot:#17bfd2;
  --text:#fff;
  --muted:#a7b3cc;
  --accent:#37d6e8;
  --ok:#22c55e;
  --bad:#ef4444;
}

/* ========== RESET / BASE ========== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

a,button,input{font:inherit}

/* ========== APP FRAME (MOBILEâ€‘FIRST) ========== */
.hud{
  width:min(100%, 960px);
  margin-inline:auto;
  padding:12px;
}
.screen{
  min-height:100dvh;
  background:
    radial-gradient(1200px 700px at 10% -10%, #0f214d 0%, #0a0e22 55%),
    radial-gradient(700px 600px at 120% 120%, #0d1a44 0%, #0a0e22 60%),
    var(--hud);
  border:2px solid var(--frame);
  border-radius:24px;
  box-shadow:0 14px 42px rgba(0,0,0,.55);
  padding:12px;
  position:relative;
  overflow:hidden;
}
.screen:before{
  content:"";
  position:absolute; inset:8px;
  border:2px solid rgba(73,230,255,.35);
  outline:1px solid rgba(73,230,255,.15);
  border-radius:18px;
  box-shadow:inset 0 0 26px rgba(73,230,255,.08), inset 0 0 2px rgba(73,230,255,.75);
  pointer-events:none;
}

/* header */
header{display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.badge{
  display:inline-flex;align-items:center;gap:.5rem;
  padding:6px 10px;border-radius:999px;font-size:.9rem;
  border:1px solid rgba(73,230,255,.35);color:#cfe9ff;
}

/* lifelines row */
.controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.lifeline{background:transparent;border:1px solid rgba(73,230,255,.35);color:#d9f9ff;
  padding:8px 12px;border-radius:12px;cursor:pointer}
.lifeline:disabled{opacity:.5;cursor:not-allowed}

/* SFX + Music */
.switch{display:inline-flex;align-items:center;gap:.5rem;padding:8px 12px;border-radius:12px;
  border:1px solid rgba(73,230,255,.35)}
.switch input{accent-color:#2be1f4;transform:scale(1.1)}

/* tiny volume slider */
#volWrap{display:flex;align-items:center;gap:.6rem;padding:8px 12px;border-radius:12px;border:1px solid rgba(73,230,255,.35)}
#vol{width:130px}

/* custom install button (appears when available) */
#installBtn{display:none;background:linear-gradient(180deg,#1fc7e8,#0ea5b7);color:#05222a;border:none;
  padding:10px 14px;border-radius:12px;font-weight:800;box-shadow:0 6px 16px rgba(31,199,232,.35);cursor:pointer}

/* ========== QUESTION PILL ========== */
.qpill{
  margin-top:10px;
  background:linear-gradient(180deg,var(--pillTop),var(--pillBot));
  border:2px solid #79f0ff;border-radius:20px;
  padding:10px 12px;
  display:grid;
  grid-template-columns:auto 1fr auto; /* avatar | text | question art */
  align-items:end; /* keeps avatar touching bottom */
  gap:12px;
}
.qthumb{
  width:110px;height:110px;border-radius:14px;overflow:hidden;align-self:end;
  display:grid;place-items:end; /* bottom align the image */
}
.qthumb img{width:100%;height:100%;object-fit:contain;object-position:bottom;transition:opacity .28s}
.qimg{width:86px;height:86px}
#qtext{
  font-weight:900;line-height:1.1;
  font-size:clamp(1.2rem, 3.6vw + .6rem, 2rem);
  letter-spacing:.3px;color:#04323a;
}

/* ========== MAIN GRID ========== */
.row{display:grid;grid-template-columns:1fr;gap:14px;margin-top:12px}
.card{
  background:var(--panel);border-radius:18px;border:3px solid var(--accent);
  padding:12px;display:grid;grid-template-rows:1fr auto;gap:10px
}

/* answers */
#answers{list-style:none;margin:0;padding:6px;display:grid;gap:10px}
.answer{
  display:flex;align-items:center;gap:12px;min-height:64px;
  background:#0E152B;border:2px solid rgba(55,214,232,.7);
  border-radius:16px;padding:14px 16px;cursor:pointer;
  transition:transform .07s,border-color .2s,box-shadow .2s
}
.answer:hover{transform:translateY(-1px);box-shadow:0 0 0 4px rgba(55,214,232,.12)}
.dot{position:relative;width:26px;height:26px;border-radius:50%;border:3px solid var(--accent);box-shadow:inset 0 0 0 4px rgba(0,0,0,.35)}
.answer .label{font-weight:800;font-size:1.05rem}
.answer.selected .dot::after,.answer.correct .dot::after{content:"";position:absolute;inset:6px;border-radius:50%;background:var(--accent)}
.answer.correct{border-color:var(--ok)} .answer.incorrect{border-color:var(--bad)}

/* footer */
footer{display:flex;align-items:center;justify-content:flex-end;gap:10px}
#status{min-height:22px;color:var(--muted);margin-right:auto;text-wrap:balance}
button.primary{background:linear-gradient(180deg,#1fc7e8,#0ea5b7);color:#05222a;border:none;padding:12px 16px;border-radius:12px;font-weight:900;letter-spacing:.3px;cursor:pointer;box-shadow:0 6px 16px rgba(31,199,232,.35)}
button.secondary{background:transparent;color:var(--text);border:1px solid rgba(73,230,255,.35);padding:12px 16px;border-radius:12px}
button:disabled{opacity:.6;cursor:not-allowed}

/* hero panel (answer side) */
.hero{background:transparent;display:flex;flex-direction:column;align-items:center;gap:10px}
#answerTitle{font-weight:900;text-align:center}
#answerInfo{color:var(--muted);text-align:center;max-width:58ch;margin:0 auto}
#heroArt{width:min(100%, 520px);aspect-ratio:1/1;display:block}
.fade-in{animation:fade .5s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* ========== DESKTOP UP ========== */
@media (min-width: 900px){
  .hud{width:min(100%, 1100px)}
  .row{grid-template-columns: 1fr 0.9fr}
  .qthumb{width:130px;height:130px}
  .qimg{width:100px;height:100px}
}

/* Prevent accidental horizontal scroll on small screens */
html,body{overflow-x:hidden}
</style>
</head>
<body>
<div class="hud">
  <div class="screen">
    <header>
      <div class="badge">Question <span id="qnum">1</span>/<span id="qtotal">10</span></div>

      <div class="controls">
        <button class="lifeline" id="ll5050">50/50</button>
        <button class="lifeline" id="llHint">Hint</button>
        <button class="lifeline" id="llSkip">Skip</button>

        <label class="switch"><input type="checkbox" id="sfxToggle" checked> ðŸ”Š SFX</label>
        <label class="switch"><input type="checkbox" id="musicToggle" checked> ðŸŽµ Music</label>
        <div id="volWrap" class="badge" style="border:1px solid rgba(73,230,255,.35)">
          Vol <input id="vol" type="range" min="0" max="1" step="0.01" value="0.8">
        </div>

        <button id="installBtn">Install App</button>
      </div>
    </header>

    <!-- Question pill: avatar | text | small question art -->
    <div class="qpill">
      <div class="qthumb"><img id="thumb" alt="Avatar"></div>
      <div id="qtext">Loading questionâ€¦</div>
      <img id="qimg" class="qimg" alt=""/>
    </div>

    <!-- Main panels -->
    <div class="row">
      <div class="card">
        <ul id="answers"></ul>
        <footer>
          <div id="status">Select an answer to continue.</div>
          <button class="secondary" id="resetBtn">Restart</button>
          <button class="primary" id="nextBtn" disabled>Next</button>
        </footer>
      </div>

      <div class="card hero">
        <div id="answerTitle"></div>
        <div id="answerInfo"></div>
        <img id="heroArt" alt="">
        <video id="victory" style="display:none;width:100%;height:auto;border-radius:12px" playsinline></video>
      </div>
    </div>
  </div>
</div>

<script>
/* ------------ Assets ------------- */
const AVATAR = {
  neutral:"./neutral-expression.png",
  happy:"./happy-expression.png",
  encouraging:"./encouraging-expression.png"
};
const MUSIC_FILE = "./Uncharted Worlds.mp3";
const VICTORY_VIDEO = "./goodjob.mp4";

/* Small inline question/answer art (emojiâ€‘style for now) */
const ART = {
  mercury:{q:"ðŸª™",a:"ðŸª™"},
  mars:{q:"ðŸŸ¥",a:"ðŸª"},
  saturn:{q:"ðŸª",a:"ðŸ’"},
  sun:{q:"â˜€ï¸",a:"â˜€ï¸"},
  galaxy:{q:"âœ¨",a:"ðŸŒŒ"},
  moon:{q:"ðŸŒ•",a:"ðŸŒ•"},
  blackhole:{q:"ðŸŒ€",a:"ðŸŒ€"},
  kuiper:{q:"ðŸ§Š",a:"ðŸ§Š"}
};

/* ------------ Quiz Data -------------- */
const QUIZ = [
  {q:"Which is the smallest planet in our Solar System?",choices:["Mercury","Mars","Venus","Pluto"],correct:0,explain:"Correct! Mercury's short orbital period is ~88 Earth days.",art:"mercury"},
  {q:"Which planet is known as the Red Planet?",choices:["Jupiter","Mars","Saturn","Neptune"],correct:1,explain:"Correct! Mars appears reddish due to iron oxide on its surface.",art:"mars"},
  {q:"Which planet has the most striking ring system?",choices:["Saturn","Uranus","Jupiter","Neptune"],correct:0,explain:"Correct! Saturnâ€™s rings are the most prominent in our Solar System.",art:"saturn"},
  {q:"What is the name of the galaxy we live in?",choices:["Andromeda","Sombrero","Milky Way","Triangulum"],correct:2,explain:"Correct! We live in the Milky Way galaxy.",art:"galaxy"},
  {q:"What kind of star is the Sun?",choices:["Neutron star","Red giant","Yellow dwarf (G-type)","White dwarf"],correct:2,explain:"Correct! The Sun is a Gâ€‘type main sequence star.",art:"sun"},
  {q:"Who was the first human to walk on the Moon?",choices:["Buzz Aldrin","Neil Armstrong","Yuri Gagarin","Alan Shepard"],correct:1,explain:"Correct! Neil Armstrong stepped onto the Moon on July 20, 1969.",art:"moon"},
  {q:"What force keeps planets in orbit around the Sun?",choices:["Magnetism","Friction","Gravity","Electricity"],correct:2,explain:"Correct! Gravity is the attractive force between masses.",art:"galaxy"},
  {q:"Which planet orbits the Sun in about 88 Earth days?",choices:["Mercury","Earth","Venus","Mars"],correct:0,explain:"Correct! Mercury completes an orbit in roughly 88 days.",art:"mercury"},
  {q:"What is the supermassive black hole at the Milky Wayâ€™s center called?",choices:["Cygnus Xâ€‘1","Sagittarius A*","V404 Cygni","Betelgeuse"],correct:1,explain:"Correct! Sagittarius A* sits at our galaxyâ€™s core.",art:"blackhole"},
  {q:"What is the Kuiper Belt?",choices:["Asteroid belt between Mars and Jupiter","A region beyond Neptune with icy bodies and dwarf planets","Another name for Saturnâ€™s rings","A field of comets that surrounds the Sun at great distances"],correct:1,explain:"Correct! The Kuiper Belt lies beyond Neptune and hosts many icy objects, including Pluto.",art:"kuiper"}
];

/* ------------ DOM refs -------------- */
const qnum = document.getElementById('qnum');
const qtotal = document.getElementById('qtotal');
const qtext = document.getElementById('qtext');
const qimg = document.getElementById('qimg');
const thumb = document.getElementById('thumb');
const answersEl = document.getElementById('answers');
const statusEl = document.getElementById('status');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');
const installBtn = document.getElementById('installBtn');

const answerTitle = document.getElementById('answerTitle');
const answerInfo = document.getElementById('answerInfo');
const heroArt = document.getElementById('heroArt');
const victoryVid = document.getElementById('victory');

/* ------------ Audio -------------- */
let audioCtx;
let music, musicGain;
function ensureAC(){ if(!audioCtx){ const AC = window.AudioContext||window.webkitAudioContext; audioCtx = new AC(); } }
function initMusic(){
  if(music) return;
  const el = new Audio(MUSIC_FILE);
  el.loop = true; el.preload = 'auto';
  el.volume = document.getElementById('vol').value;
  music = el;
  if(document.getElementById('musicToggle').checked){ music.play().catch(()=>{}); }
}
function playCorrectSfx(){
  if(!document.getElementById('sfxToggle').checked) return;
  ensureAC();
  const t=audioCtx.currentTime, o=audioCtx.createOscillator(), g=audioCtx.createGain();
  o.type='sine'; o.frequency.setValueAtTime(660,t); o.frequency.exponentialRampToValueAtTime(990,t+.18);
  g.gain.setValueAtTime(.0001,t); g.gain.exponentialRampToValueAtTime(.25,t+.02); g.gain.exponentialRampToValueAtTime(.0001,t+.22);
  o.connect(g).connect(audioCtx.destination); o.start(t); o.stop(t+.24);
}

/* Music controls */
document.getElementById('musicToggle').addEventListener('change',e=>{
  initMusic();
  if(e.target.checked){ music.play().catch(()=>{}); } else { music.pause(); }
});
document.getElementById('vol').addEventListener('input',e=>{
  if(music){ music.volume = +e.target.value; }
});

/* ------------ Lifelines (one use each) -------------- */
const lifelines = { 'll5050':true,'llHint':true,'llSkip':true };
for(const id of Object.keys(lifelines)){
  document.getElementById(id).addEventListener('click',()=>useLifeline(id));
}
function useLifeline(id){
  if(!lifelines[id]) return;
  lifelines[id]=false;
  document.getElementById(id).disabled = true;
  if(id==='ll5050') fiftyFifty();
  if(id==='llHint') hint();
  if(id==='llSkip') { idx=Math.min(idx+1, QUIZ.length-1); renderQuestion(); }
}
function fiftyFifty(){
  const q = QUIZ[order[idx]];
  const wrong = answersEl.querySelectorAll('li:not(.correct)');
  let toHide = Array.from(wrong).slice(0, Math.max(0, wrong.length-1));
  toHide.forEach(li=>li.style.opacity=.35);
}
function hint(){
  const q = QUIZ[order[idx]];
  statusEl.textContent = "Hint: Focus on the key property the question mentions.";
}

/* ------------ Avatar/Art helpers -------------- */
function setThumb(state){
  const src = AVATAR[state] || AVATAR.neutral;
  thumb.style.opacity = 0;
  thumb.onload = () => thumb.style.opacity = 1;
  thumb.src = src;
}
function setQArt(key){
  const icon = ART[key]?.q || "âœ¨";
  qimg.alt = key; qimg.src = `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='62' font-size='64' text-anchor='middle'>${icon}</text></svg>`)}`;
}
function setAnswerArt(key){
  const icon = ART[key]?.a || "ðŸŒŒ";
  heroArt.classList.remove('fade-in');
  heroArt.src = `data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='62' font-size='64' text-anchor='middle'>${icon}</text></svg>`)}`;
  // force reflow to restart animation
  void heroArt.offsetWidth;
  heroArt.classList.add('fade-in');
}

/* ------------ Quiz logic -------------- */
qtotal.textContent = QUIZ.length;
let order = [...Array(QUIZ.length).keys()].sort(()=>Math.random()-.5);
let idx = 0;
let answered = new Array(QUIZ.length).fill(null);
let score = 0;

function renderQuestion(){
  const q = QUIZ[order[idx]];
  qnum.textContent = idx+1;
  qtext.textContent = q.q;
  setThumb('neutral');
  setQArt(q.art);

  answersEl.innerHTML = '';
  q.choices.forEach((choice,i)=>{
    const li=document.createElement('li');
    li.className='answer';
    li.innerHTML=`<span class="dot"></span><span class="label">${choice}</span>`;
    li.addEventListener('click',()=>selectAnswer(i,li,q));
    answersEl.appendChild(li);
  });

  // reset right panel
  answerTitle.textContent="";
  answerInfo.textContent="";
  heroArt.src="";
  victoryVid.style.display="none"; victoryVid.pause(); victoryVid.src="";

  statusEl.textContent="Select an answer to continue.";
  nextBtn.disabled=true;
}

function selectAnswer(i,li,q){
  const qi = order[idx], prev = answered[qi];
  answered[qi] = i;

  answersEl.querySelectorAll('.answer').forEach(el=>el.classList.remove('selected','correct','incorrect'));
  li.classList.add('selected');
  const correctLi = answersEl.children[q.correct];
  correctLi.classList.add('correct');
  if(i!==q.correct) li.classList.add('incorrect');

  if(prev===null){ if(i===q.correct) score++; }
  else{
    if(prev===q.correct && i!==q.correct) score--;
    if(prev!==q.correct && i===q.correct) score++;
  }

  if(i===q.correct){
    setThumb('happy');
    playCorrectSfx();
    showAnswer(q);
  }else{
    setThumb('encouraging');
    statusEl.textContent = q.explain.replace(/^Correct!/, "Not quite.");
  }
  nextBtn.disabled=false;
}

function showAnswer(q){
  answerTitle.textContent = q.choices[q.correct];
  answerInfo.textContent = q.explain;
  setAnswerArt(q.art);
}

nextBtn.addEventListener('click', ()=>{
  if(idx < QUIZ.length-1){ idx++; renderQuestion(); }
  else { endGame(); }
});

resetBtn.addEventListener('click', reset);
function reset(){
  score=0; answered.fill(null); order.sort(()=>Math.random()-.5); idx=0; renderQuestion();
}

/* victory */
function endGame(){
  qtext.textContent = "Mission Summary";
  answerTitle.textContent = `Score: ${score} / ${QUIZ.length}`;
  answerInfo.textContent = "Nice work, cadet! Watch the brief debrief video.";
  heroArt.src="";
  victoryVid.src = VICTORY_VIDEO;
  victoryVid.style.display="block";
  victoryVid.play().catch(()=>{});
  statusEl.textContent="";

  victoryVid.onended = ()=>{
    // auto restart & resume music
    reset();
    if(document.getElementById('musicToggle').checked){ initMusic(); music.play().catch(()=>{}); }
  };
}

/* ------------ PWA install (custom button) -------------- */
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-flex';
});
installBtn.addEventListener('click', async ()=>{
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  const {outcome} = await deferredPrompt.userChoice;
  deferredPrompt = null;
  if(outcome !== 'dismissed'){ installBtn.style.display='none'; }
});

/* ------------ Init -------------- */
window.addEventListener('load', ()=>{
  // kick off music immediately if allowed (mobile may require interaction)
  initMusic();
  renderQuestion();
});
</script>
</body>
</html>
